<Page
    x:Class="SkillManager.Views.LibraryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:SkillManager.Models"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:SkillManager.ViewModels"
    Title="技能库"
    d:DataContext="{d:DesignInstance vm:LibraryViewModel}"
    d:DesignHeight="600"
    d:DesignWidth="900"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  标题区  -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock
                FontSize="28"
                FontWeight="SemiBold"
                Text="技能库" />
            <TextBlock
                Margin="0,4,0,0"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="管理已导入的技能文件夹" />
        </StackPanel>

        <!--  工具栏  -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:TextBox
                Grid.Column="0"
                MaxWidth="400"
                HorizontalAlignment="Left"
                Icon="{ui:SymbolIcon Search24}"
                PlaceholderText="搜索技能..."
                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <ui:Button
                    Margin="0,0,8,0"
                    Command="{Binding RefreshSkillsCommand}"
                    Content="刷新"
                    Icon="{ui:SymbolIcon ArrowSync24}" />
                <ui:Button
                    Command="{Binding OpenLibraryFolderCommand}"
                    Content="打开文件夹"
                    Icon="{ui:SymbolIcon FolderOpen24}" />
            </StackPanel>
        </Grid>

        <!--  技能列表  -->
        <ui:ListView
            Grid.Row="2"
            ItemsSource="{Binding Skills}"
            SelectedItem="{Binding SelectedSkill}">
            <ui:ListView.ItemTemplate>
                <DataTemplate DataType="{x:Type models:SkillFolder}">
                    <ui:Card Margin="0,4" Padding="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!--  图标  -->
                            <Border
                                Grid.Column="0"
                                Width="48"
                                Height="48"
                                Margin="0,0,16,0"
                                Background="{DynamicResource ControlFillColorDefaultBrush}"
                                CornerRadius="8">
                                <ui:SymbolIcon
                                    FontSize="24"
                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                    Symbol="Code24" />
                            </Border>

                            <!--  信息  -->
                            <StackPanel
                                Grid.Column="1"
                                VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Text="{Binding Name}" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                    Text="{Binding Description}"
                                    TextTrimming="CharacterEllipsis" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    Foreground="{DynamicResource TextFillColorTertiaryBrush}">
                                    <Run Text="创建时间:" />
                                    <Run Text="{Binding CreatedTime, StringFormat='yyyy-MM-dd HH:mm'}" />
                                </TextBlock>
                            </StackPanel>

                            <!--  操作按钮  -->
                            <StackPanel
                                Grid.Column="2"
                                VerticalAlignment="Center"
                                Orientation="Horizontal">
                                <ui:Button
                                    Margin="0,0,8,0"
                                    Appearance="Secondary"
                                    Command="{Binding DataContext.ViewSkillMdCommand, RelativeSource={RelativeSource AncestorType=ui:ListView}}"
                                    CommandParameter="{Binding}"
                                    Icon="{ui:SymbolIcon Document24}"
                                    ToolTip="查看 SKILL.md" />
                                <ui:Button
                                    Margin="0,0,8,0"
                                    Appearance="Secondary"
                                    Command="{Binding DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType=ui:ListView}}"
                                    CommandParameter="{Binding}"
                                    Icon="{ui:SymbolIcon FolderOpen24}"
                                    ToolTip="打开文件夹" />
                                <ui:Button
                                    Appearance="Danger"
                                    Command="{Binding DataContext.DeleteSkillCommand, RelativeSource={RelativeSource AncestorType=ui:ListView}}"
                                    CommandParameter="{Binding}"
                                    Icon="{ui:SymbolIcon Delete24}"
                                    ToolTip="删除" />
                            </StackPanel>
                        </Grid>
                    </ui:Card>
                </DataTemplate>
            </ui:ListView.ItemTemplate>
        </ui:ListView>

        <!--  空状态  -->
        <ui:Card
            Grid.Row="2"
            Padding="48"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Visibility="{Binding Skills.Count, Converter={StaticResource CountToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center">
                <ui:SymbolIcon
                    FontSize="64"
                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                    Symbol="Box24" />
                <TextBlock
                    Margin="0,16,0,0"
                    HorizontalAlignment="Center"
                    FontSize="18"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Text="技能库为空" />
                <TextBlock
                    Margin="0,8,0,0"
                    HorizontalAlignment="Center"
                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                    Text="前往「扫描导入」页面添加技能" />
            </StackPanel>
        </ui:Card>

        <!--  状态栏  -->
        <ui:Card Grid.Row="3" Margin="0,16,0,0" Padding="12">
            <TextBlock
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="{Binding StatusMessage}" />
        </ui:Card>
    </Grid>
</Page>
