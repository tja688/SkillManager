<Page
    x:Class="SkillManager.Views.DownloadSkillsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:SkillManager.Models"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:SkillManager.ViewModels"
    Title="下载Skills"
    d:DataContext="{d:DesignInstance vm:DownloadSkillsViewModel}"
    d:DesignHeight="600"
    d:DesignWidth="900"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Loaded="Page_Loaded"
    mc:Ignorable="d">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  标题区  -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock
                FontSize="28"
                FontWeight="SemiBold"
                Text="下载Skills" />
            <TextBlock
                Margin="0,4,0,0"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="收集常用技能链接，点击即可在默认浏览器打开" />
        </StackPanel>

        <!--  新增链接  -->
        <ui:Card Grid.Row="1" Margin="0,0,0,16" Padding="16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:TextBox
                        Grid.Column="0"
                        Margin="0,0,12,0"
                        Icon="{ui:SymbolIcon Tag24}"
                        PlaceholderText="链接标题（可选）"
                        Text="{Binding NewTitle, UpdateSourceTrigger=PropertyChanged}" />
                    <ui:TextBox
                        Grid.Column="1"
                        Margin="0,0,12,0"
                        Icon="{ui:SymbolIcon Globe24}"
                        PlaceholderText="https://example.com"
                        Text="{Binding NewUrl, UpdateSourceTrigger=PropertyChanged}" />
                    <ui:Button
                        Grid.Column="2"
                        Appearance="Primary"
                        Command="{Binding AddLinkCommand}"
                        Content="添加"
                        Icon="{ui:SymbolIcon ArrowDownload24}" />
                </Grid>

                <TextBlock
                    Grid.Row="1"
                    Margin="0,8,0,0"
                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                    Text="支持批量管理与一键删除，适合整理下载页、官方文档等资源" />
            </Grid>
        </ui:Card>

        <!--  链接列表  -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="SemiBold">
                    <Run Text="链接列表 (" />
                    <Run Text="{Binding Links.Count, Mode=OneWay}" />
                    <Run Text=")" />
                </TextBlock>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <ui:Button
                        Margin="0,0,8,0"
                        Command="{Binding SelectAllCommand}"
                        Content="全选"
                        Icon="{ui:SymbolIcon Checkmark24}"
                        IsEnabled="{Binding Links.Count, Converter={StaticResource CountToBoolConverter}}" />
                    <ui:Button
                        Margin="0,0,8,0"
                        Command="{Binding ClearSelectionCommand}"
                        Content="清空选择"
                        Icon="{ui:SymbolIcon Dismiss24}"
                        IsEnabled="{Binding HasSelection}" />
                    <ui:Button
                        Appearance="Danger"
                        Command="{Binding DeleteSelectedCommand}"
                        Content="删除选中"
                        Icon="{ui:SymbolIcon Delete24}"
                        IsEnabled="{Binding HasSelection}" />
                </StackPanel>
            </Grid>

            <ItemsControl
                Grid.Row="1"
                ItemsSource="{Binding Links}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}, Converter={StaticResource WidthToColumnsConverter}, ConverterParameter=320}" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Margin" Value="8" />
                    </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:DownloadLinkItem}">
                        <ui:Card Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <CheckBox
                                        Grid.Column="0"
                                        Margin="0,2,8,0"
                                        VerticalAlignment="Top"
                                        IsChecked="{Binding IsSelected}" />
                                    <TextBlock
                                        Grid.Column="1"
                                        FontSize="15"
                                        FontWeight="SemiBold"
                                        Text="{Binding Title}"
                                        TextTrimming="CharacterEllipsis" />
                                </Grid>

                                <TextBlock
                                    Grid.Row="1"
                                    Margin="0,6,0,0"
                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                    Text="{Binding Url}"
                                    TextTrimming="CharacterEllipsis" />

                                <StackPanel
                                    Grid.Row="2"
                                    Margin="0,12,0,0"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">
                                    <ui:Button
                                        Margin="0,0,6,0"
                                        Command="{Binding DataContext.OpenLinkCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                        CommandParameter="{Binding}"
                                        Content="打开"
                                        Icon="{ui:SymbolIcon Globe24}" />
                                    <ui:Button
                                        Appearance="Danger"
                                        Command="{Binding DataContext.DeleteLinkCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                        CommandParameter="{Binding}"
                                        Content="删除"
                                        Icon="{ui:SymbolIcon Delete24}" />
                                </StackPanel>
                            </Grid>
                        </ui:Card>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!--  空状态  -->
            <ui:Card
                Grid.Row="1"
                Padding="48"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{Binding Links.Count, Converter={StaticResource CountToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center">
                    <ui:SymbolIcon
                        FontSize="64"
                        Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                        Symbol="Globe24" />
                    <TextBlock
                        Margin="0,16,0,0"
                        HorizontalAlignment="Center"
                        FontSize="18"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Text="暂无链接" />
                    <TextBlock
                        Margin="0,8,0,0"
                        HorizontalAlignment="Center"
                        Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                        Text="添加常用技能下载入口，便于快速打开" />
                </StackPanel>
            </ui:Card>
        </Grid>

        <!--  状态栏  -->
        <ui:Card Grid.Row="3" Margin="0,16,0,0" Padding="12">
            <TextBlock
                VerticalAlignment="Center"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="{Binding StatusMessage}" />
        </ui:Card>
    </Grid>
</Page>
