<ui:FluentWindow
    x:Class="SkillManager.Views.DebugWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SkillManager.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:services="clr-namespace:SkillManager.Services"
    Title="ðŸ”§ è°ƒè¯•å·¥å…· - ScrollViewer Focus/Hitching Issue"
    Width="900"
    Height="700"
    MinWidth="700"
    MinHeight="500"
    WindowStartupLocation="CenterOwner"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="Round"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <ui:TitleBar Title="ðŸ”§ è°ƒè¯•å·¥å…·" Grid.Row="0">
            <ui:TitleBar.Header>
                <StackPanel Orientation="Horizontal">
                    <ui:SymbolIcon
                        Margin="8,0"
                        FontSize="20"
                        Symbol="Bug24" />
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Text="è°ƒè¯•å·¥å…·" />
                </StackPanel>
            </ui:TitleBar.Header>
        </ui:TitleBar>

        <!-- ä¸»å†…å®¹ -->
        <Grid Grid.Row="1" Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- è°ƒè¯•é€‰é¡¹åŒºåŸŸ -->
            <ui:Card Grid.Row="0" Margin="0,0,0,16">
                <Expander IsExpanded="True">
                    <Expander.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Settings24" Margin="0,0,8,0" />
                            <TextBlock Text="è°ƒè¯•é€‰é¡¹ - WPF ScrollViewer Focus/Hitching Issue" FontWeight="SemiBold" FontSize="14" />
                        </StackPanel>
                    </Expander.Header>
                    <Grid Margin="0,8,0,0">
                        <ItemsControl x:Name="DebugOptionsItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type services:DebugOption}">
                                    <ui:Card Margin="0,0,0,8" Padding="12">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <ui:ToggleSwitch
                                                Grid.Column="0"
                                                IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                                VerticalAlignment="Center"
                                                Margin="0,0,12,0" />

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13" />
                                                <TextBlock Text="{Binding Description}" 
                                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                                           FontSize="12"
                                                           TextWrapping="Wrap"
                                                           Margin="0,2,0,0" />
                                            </StackPanel>

                                            <TextBlock Grid.Column="2" 
                                                       Text="{Binding Category}" 
                                                       Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                                       FontSize="11"
                                                       VerticalAlignment="Center"
                                                       Margin="12,0,0,0" />
                                        </Grid>
                                    </ui:Card>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </Expander>
            </ui:Card>

            <!-- å¿«æ·æ“ä½œ -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,12">
                <ui:Button Content="å¯ç”¨å…¨éƒ¨" Icon="{ui:SymbolIcon CheckmarkCircle24}" Click="EnableAll_Click" Margin="0,0,8,0" />
                <ui:Button Content="ç¦ç”¨å…¨éƒ¨" Icon="{ui:SymbolIcon DismissCircle24}" Click="DisableAll_Click" Margin="0,0,8,0" />
                <ui:Button Content="æ¸…ç©ºæ—¥å¿—" Icon="{ui:SymbolIcon Delete24}" Click="ClearLogs_Click" Margin="0,0,8,0" Appearance="Caution" />
                <ui:Button Content="å¤åˆ¶å…¨éƒ¨æ—¥å¿—" Icon="{ui:SymbolIcon Copy24}" Click="CopyAllLogs_Click" Margin="0,0,8,0" />
                <ui:Button Content="åˆ·æ–°è§†å›¾" Icon="{ui:SymbolIcon ArrowClockwise24}" Click="Refresh_Click" />
            </StackPanel>

            <!-- æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ -->
            <ui:Card Grid.Row="2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="DocumentText24" Margin="0,0,8,0" />
                            <TextBlock Text="è°ƒè¯•æ—¥å¿—" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center" />
                            <TextBlock x:Name="LogCountText" 
                                       Text=" (0 æ¡)" 
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                       FontSize="13" 
                                       VerticalAlignment="Center" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <ui:TextBox x:Name="FilterTextBox"
                                        PlaceholderText="ç­›é€‰æ—¥å¿—..."
                                        Width="200"
                                        TextChanged="FilterTextBox_TextChanged"
                                        Margin="0,0,8,0" />
                            <ui:ToggleSwitch x:Name="AutoScrollToggle" 
                                             Content="è‡ªåŠ¨æ»šåŠ¨" 
                                             IsChecked="True" />
                        </StackPanel>
                    </Grid>

                    <ListView x:Name="LogListView" 
                              Grid.Row="1" 
                              SelectionMode="Extended"
                              VirtualizingPanel.IsVirtualizing="True"
                              VirtualizingPanel.VirtualizationMode="Recycling">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="æ—¶é—´" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Timestamp, StringFormat=HH:mm:ss.fff}" 
                                                       FontFamily="Consolas"
                                                       FontSize="12" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="çº§åˆ«" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="3" Padding="4,2" HorizontalAlignment="Left">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Level}" Value="Info">
                                                                <Setter Property="Background" Value="#2196F3" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                                                <Setter Property="Background" Value="#FF9800" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                                                <Setter Property="Background" Value="#F44336" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Level}" Value="Event">
                                                                <Setter Property="Background" Value="#4CAF50" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding Level}" 
                                                           Foreground="White" 
                                                           FontSize="11" 
                                                           FontWeight="SemiBold" />
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="ç±»åˆ«" Width="140">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Category}" 
                                                       FontFamily="Consolas"
                                                       FontSize="12"
                                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="æ¶ˆæ¯" Width="380">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Message}" 
                                                       FontFamily="Consolas"
                                                       FontSize="12"
                                                       TextTrimming="CharacterEllipsis"
                                                       ToolTip="{Binding Message}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="æ¥æº" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Source}" 
                                                       FontFamily="Consolas"
                                                       FontSize="12"
                                                       Foreground="{DynamicResource TextFillColorTertiaryBrush}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>

                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="å¤åˆ¶é€‰ä¸­æ—¥å¿—" Click="CopySelectedLogs_Click">
                                    <MenuItem.Icon>
                                        <ui:SymbolIcon Symbol="Copy24" />
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="å¤åˆ¶å…¨éƒ¨æ—¥å¿—" Click="CopyAllLogs_Click">
                                    <MenuItem.Icon>
                                        <ui:SymbolIcon Symbol="CopySelect24" />
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </ListView.ContextMenu>
                    </ListView>
                </Grid>
            </ui:Card>

            <!-- åº•éƒ¨çŠ¶æ€æ  -->
            <Border Grid.Row="3" Margin="0,12,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock x:Name="StatusText" 
                               Text="ðŸ’¡ æç¤ºï¼šå¯ç”¨è°ƒè¯•é€‰é¡¹åŽï¼Œåœ¨æŠ€èƒ½åº“é¡µé¢è¿›è¡Œæ»šåŠ¨æ“ä½œå³å¯çœ‹åˆ°ç›¸å…³æ—¥å¿—" 
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                               FontSize="12"
                               VerticalAlignment="Center" />

                    <ui:Button Grid.Column="1" 
                               Content="å…³é—­" 
                               Click="Close_Click" 
                               Appearance="Secondary" />
                </Grid>
            </Border>
        </Grid>
    </Grid>
</ui:FluentWindow>
